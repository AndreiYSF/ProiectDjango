{% extends "hardware/baza.html" %}

{% block title %}Catalog produse{% endblock %}

{% block content %}
<section class="page-heading">
    <h1>Catalog de produse</h1>
    <p>Explorează sculele și accesoriile disponibile în magazinul nostru și filtrează după categorie, brand sau preț.</p>
</section>

{% if filter_errors %}
<section class="messages errors">
    <h2>Erori filtre</h2>
    <ul>
        {% for eroare in filter_errors %}
        <li>{{ eroare }}</li>
        {% endfor %}
    </ul>
</section>
{% endif %}

<section class="filter-section">
    <form method="get" class="filter-form">
        <div class="filter-grid">
            <label>
                Categorie
                <select name="category">
                    <option value="">Toate</option>
                    {% for category in categories %}
                    <option value="{{ category.slug }}" {% if active_filters.category == category.slug or active_filters.category_slug == category.slug %}selected{% endif %}>
                        {{ category.name }}
                    </option>
                    {% endfor %}
                </select>
            </label>
            <label>
                Brand
                <select name="brand">
                    <option value="">Toate</option>
                    {% for brand in brands %}
                    <option value="{{ brand.slug }}" {% if active_filters.brand == brand.slug or active_filters.brand_slug == brand.slug %}selected{% endif %}>
                        {{ brand.name }}
                    </option>
                    {% endfor %}
                </select>
            </label>
            <label>
                Preț minim (lei)
                <input type="number" step="0.01" name="min_price" value="{{ active_filters.min_price }}">
            </label>
            <label>
                Preț maxim (lei)
                <input type="number" step="0.01" name="max_price" value="{{ active_filters.max_price }}">
            </label>
            <label>
                Sortare
                <select name="sort">
                    {% for value, label in sort_options %}
                    <option value="{{ value }}" {% if sort_option == value %}selected{% endif %}>
                        {{ label }}
                    </option>
                    {% endfor %}
                </select>
            </label>
        </div>
        <div class="filter-actions">
            <button type="submit" class="btn-primary">Aplică filtre</button>
            <a href="{% url 'hardware:catalog' %}" class="btn-secondary">Resetează</a>
        </div>
    </form>
</section>

<section class="catalog-grid">
    {% if products %}
        {% for product in products %}
        <article class="product-card">
            <h2><a href="{% url 'hardware:product_detail' product.slug %}">{{ product.name }}</a></h2>
            <p class="product-meta">
                <span>{{ product.category.name }}</span> ·
                <span>{{ product.brand.name }}</span> ·
                <span>{{ product.get_condition_display }}</span>
            </p>
            <p class="product-price">{{ product.price }} lei</p>
            <p class="product-description">{{ product.description|default:"Descriere indisponibilă momentan." }}</p>
            <form method="post" action="{% url 'hardware:cart_add' product.slug %}" class="add-to-cart-form">
                {% csrf_token %}
                <label class="sr-only" for="qty-{{ product.pk }}">Cantitate</label>
                <input type="number" name="qty" id="qty-{{ product.pk }}" value="1" min="1" max="999">
                <button type="submit" class="btn-primary">Adaugă în coș</button>
            </form>
        </article>
        {% endfor %}
    {% else %}
    <p>Nu am găsit produse care să se potrivească filtrării curente.</p>
    {% endif %}
</section>

{% if is_paginated %}
<nav class="pagination">
    {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}{% if current_query %}&{{ current_query }}{% endif %}">« Anterior</a>
    {% endif %}
    <span>Pagina {{ page_obj.number }} din {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}{% if current_query %}&{{ current_query }}{% endif %}">Următoare »</a>
    {% endif %}
</nav>
{% endif %}
{% endblock %}
